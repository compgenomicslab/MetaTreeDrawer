<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore Tree: {{treename}}</title>
    <!-- Bootstrap CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/static/js/bootstrap.bundle.min.js"></script>

    <style>
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .btn-small {
            font-size: 0.85rem;
            padding: 5px 10px;
        }

        .layout-settings {
            display: none;
        }
    </style>
</head>
<body>
    <div class="control-panel">
        <h5>Control Panel</h5>

        <!-- Properties Table -->
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Select</th>
                    <th>Property Name</th>
                    <th>Type</th>
                </tr>
            </thead>
            <tbody id="propertiesTable">
                <!-- Dynamically populated -->
                <tr>
                    <td><input type="checkbox" class="selectProperty" value="Branch Length"></td>
                    <td>Branch Length</td>
                    <td>Numerical</td>
                </tr>
                <tr>
                    <td><input type="checkbox" class="selectProperty" value="Bootstrap Support"></td>
                    <td>Bootstrap Support</td>
                    <td>Binary</td>
                </tr>
                <tr>
                    <td><input type="checkbox" class="selectProperty" value="Node Label"></td>
                    <td>Node Label</td>
                    <td>Categorical</td>
                </tr>
                <tr>
                    <td><input type="checkbox" class="selectProperty" value="Taxonomic Group"></td>
                    <td>Taxonomic Group</td>
                    <td>Categorical</td>
                </tr>
            </tbody>
        </table>

        <button id="applyLayoutBtn" class="btn btn-primary mt-3">Apply Layout to Selected</button>

        <!-- Layout Configuration Section -->
        <div id="layoutConfigSection" class="layout-settings">
            <h5>Configure Layout</h5>
            <select class="form-control" id="layoutSelect">
                <option value="heatmap-layout">Heatmap Layout</option>
                <option value="colorbranch-layout">Color Branch Layout</option>
            </select>
            <div id="layoutSettings" class="mt-3">
                <!-- Add additional layout-specific settings here -->
                <label for="columnWidth">Column Width</label>
                <input type="number" id="columnWidth" class="form-control" value="70">
            </div>
            <button id="addLayerBtn" class="btn btn-success mt-3">Add Layer</button>
        </div>
    </div>

    <script>
        // Track selected properties
        const selectedProperties = [];

        // Handle property selection
        $(document).on('change', '.selectProperty', function () {
            const property = $(this).val();
            if ($(this).is(':checked')) {
                selectedProperties.push(property);
            } else {
                const index = selectedProperties.indexOf(property);
                if (index > -1) selectedProperties.splice(index, 1);
            }
        });

        // Handle Apply Layout Button
        $('#applyLayoutBtn').click(() => {
            if (selectedProperties.length === 0) {
                alert('Please select at least one property.');
                return;
            }

            $('#layoutConfigSection').show();
            alert(`Selected Properties: ${selectedProperties.join(', ')}`);
        });

        // Handle Add Layer Button
        $('#addLayerBtn').click(() => {
            const layout = $('#layoutSelect').val();
            if (!layout) {
                alert('Please select a layout.');
                return;
            }

            const columnWidth = $('#columnWidth').val();
            const layerConfig = {
                layout,
                properties: selectedProperties,
                settings: { columnWidth }
            };

            // Send the layer configuration to the backend (replace alert with backend interaction)
            alert(`Layer Added:\n${JSON.stringify(layerConfig, null, 2)}`);

            // Clear selections and reset UI
            $('.selectProperty').prop('checked', false);
            selectedProperties.length = 0;
            $('#layoutConfigSection').hide();
        });
    </script>
</body>
</html>
